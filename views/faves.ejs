<%-include('./partials/header.ejs', { user}) %>

<br>
<h3 class="ms-2">My favorites:</h3>

<div class="ms-4">

<ul>
<% allFaves.forEach(drug => { %>
    <% if (drug.nickname) { %>
    <li>Nickname: "<%=drug.nickname%>"
    <br>
    <a href="/drugs/<%=drug.api_id %>"><%=drug.brand_name%></a></li>
   <% } else { %>
    <li><a href="/drugs/<%=drug.api_id %>"><%=drug.brand_name%></a></li> 
   <%}%>
    <!-- DELETE BUTTON -->
    <form method="POST" action="/favorites/?_method=DELETE">
        <button type="submit" value="<%=drug.id%>" name="drugId">Delete</button>
    </form>
    
     <!-- EDIT BUTTON -->
     <% if (! drug.nickname) { %>
     <form method="POST" action="/favorites/?_method=PUT">
        <label for="type">Set nickname:</label>
        <input hidden value="<%=drug.id%>" name="drugId">
        <input id="type" type="text" value="<%=drug.nickname%>" name="nickname">
        <button type="submit">Save</button>
    </form>
        <% } %>    
        <br>
    
    <!-- COMMENTS -->

        <h5>Comments:</h5>


       <% if (drug.comments.length == 0) { %>
            <p>No comments yet!</p>
       <% } else { %>
        <% drug.dataValues.comments.forEach(function(comment) { %>
            <p> <%=comment.user.email%> says:</p>
            <p><%= comment.content %></p>
         <% })} %>

         <h6>Leave a comment:</h6>
            <form method="POST" action="/favorites/comment">
                <input hidden type="text" value="<%=user.id%>" name="userId"/>
                <input hidden type="text" value="<%=drug.id%>" name="drugId"/>
                <input type="text" placeholder="Write your comment" name="content"/>
                <button type="submit">Submit</button>
            </form> 
            <br>
    
        <%})%>
</div>

<%-include('./partials/footer.ejs') %>